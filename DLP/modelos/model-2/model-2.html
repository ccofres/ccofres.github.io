<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modelo 2</title>

    <script src="../../codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="../../codemirror/lib/codemirror.css" />
    <script src="../../codemirror/mode/javascript/javascript.js"></script>
    <script src="../../codemirror/addon/edit/matchbrackets.js"></script>

    <link rel="stylesheet" href="../../../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
  </head>
  <body>
    <!--Nav top -->
    <nav class="flex-nav-top">
      <li><a href="../../../index.html">Home</a></li>
      <li>
        <a href="../../dlp.html">DLP - Playground</a>
      </li>
      <li><a href="../model.html">Modelos</a></li>
      <li>
        <a href="../../tf-playground/tfplayground.html"
          >TensorFlow Playground</a
        >
      </li>
      <li><a href="../../ganlab/ganlab.html">GAN Lab</a></li>
    </nav>
    <!-- FIN Nav top-->
    <!-- Nav left -->
    <nav class="flex-nav-left">
      <button class="btn-left">
        <a href="../model-1/model-1.html">Model 1</a>
      </button>
      <button class="btn-left"><a href="./model-2.html">Model 2</a></button>
      <button class="btn-left"><a href="#">Model 3</a></button>
      <button class="btn-left"><a href="#">Model 4</a></button>
    </nav>
    <!-- FIN Nav left-->
    <h2>CodeMirror Editor</h2>
    <!--CodeMirror Editor-->
    <form class="editor">
      <fieldset>
        <!-- Create a simple CodeMirror instance -->
        <textarea id="editor" class="editorArea">
    async function doTraining(model){
            const history =
                  await model.fit(xs, ys,
                        { epochs: 300,
                          callbacks:{
                              onEpochEnd: async(epoch, logs) =>{
                                  console.log("Epoch:"
                                              + epoch
                                              + " Loss:"
                                              + logs.loss);

                              }
                          }
                        });
    }

    const model = tf.sequential();
    model.add(tf.layers.dense({units: 1, inputShape: [1]}));
    model.compile({optimizer: 'sgd', loss: 'meanAbsoluteError'});
    model.summary();

    const trainData = {
      sizeMB:  [0.080, 9.000, 0.001, 0.100, 8.000, 5.000, 0.100, 6.000, 0.050, 0.500,
                0.002, 2.000, 0.005, 10.00, 0.010, 7.000, 6.000, 5.000, 1.000, 1.000],
      timeSec: [0.135, 0.739, 0.067, 0.126, 0.646, 0.435, 0.069, 0.497, 0.068, 0.116,
                0.070, 0.289, 0.076, 0.744, 0.083, 0.560, 0.480, 0.399, 0.153, 0.149]
    };
    const testData = {
      sizeMB:  [5.000, 0.200, 0.001, 9.000, 0.002, 0.020, 0.008, 4.000, 0.001, 1.000,
                0.005, 0.080, 0.800, 0.200, 0.050, 7.000, 0.005, 0.002, 8.000, 0.008],
      timeSec: [0.425, 0.098, 0.052, 0.686, 0.066, 0.078, 0.070, 0.375, 0.058, 0.136,
                0.052, 0.063, 0.183, 0.087, 0.066, 0.558, 0.066, 0.068, 0.610, 0.057]
    };
    const xs = tf.tensor2d(trainData.sizeMB, [20, 1]);
    const ys = tf.tensor2d(trainData.timeSec, [20, 1]);

    const smallFileMB = 1;
    const bigFileMB = 100;
    const hugeFileMB = 10000;
        doTraining(model).then(() => {
            //alert(model.predict(tf.tensor2d([smallFileMB, bigFileMB, hugeFileMB], [3,1])));
            alert(model.predict(tf.tensor2d([[smallFileMB], [bigFileMB], [hugeFileMB]])));
            model.predict(tf.tensor2d([[smallFileMB],[bigFileMB],[hugeFileMB]])).print();
            //modo flat-array de funcion tf.tensor2d()
            //([valor1,valor2],[shape])
        });
        </textarea>
        <!-- Create a simple CodeMirror instance -->
      </fieldset>
    </form>
    <button class="btn-left runButton"><a href="#">Click to run!</a></button>
    <!--CodeMirror Editor-->
    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        lineNumbers: true,
        mode: "text/javascript",
        matchBrackets: true,
      });
      const runBtn = document.querySelector(".runButton");
      runBtn.addEventListener("click", function (event) {
        runScript();
      });
      function runScript() {
        async function doTraining(model) {
          const history = await model.fit(xs, ys, {
            epochs: 300,
            callbacks: {
              onEpochEnd: async (epoch, logs) => {
                console.log("Epoch:" + epoch + " Loss:" + logs.loss);
              },
            },
          });
        }

        const model = tf.sequential();
        model.add(tf.layers.dense({ units: 1, inputShape: [1] }));
        model.compile({ optimizer: "sgd", loss: "meanAbsoluteError" });
        model.summary();

        const trainData = {
          sizeMB: [
            0.08,
            9.0,
            0.001,
            0.1,
            8.0,
            5.0,
            0.1,
            6.0,
            0.05,
            0.5,
            0.002,
            2.0,
            0.005,
            10.0,
            0.01,
            7.0,
            6.0,
            5.0,
            1.0,
            1.0,
          ],
          timeSec: [
            0.135,
            0.739,
            0.067,
            0.126,
            0.646,
            0.435,
            0.069,
            0.497,
            0.068,
            0.116,
            0.07,
            0.289,
            0.076,
            0.744,
            0.083,
            0.56,
            0.48,
            0.399,
            0.153,
            0.149,
          ],
        };
        const testData = {
          sizeMB: [
            5.0,
            0.2,
            0.001,
            9.0,
            0.002,
            0.02,
            0.008,
            4.0,
            0.001,
            1.0,
            0.005,
            0.08,
            0.8,
            0.2,
            0.05,
            7.0,
            0.005,
            0.002,
            8.0,
            0.008,
          ],
          timeSec: [
            0.425,
            0.098,
            0.052,
            0.686,
            0.066,
            0.078,
            0.07,
            0.375,
            0.058,
            0.136,
            0.052,
            0.063,
            0.183,
            0.087,
            0.066,
            0.558,
            0.066,
            0.068,
            0.61,
            0.057,
          ],
        };
        const xs = tf.tensor2d(trainData.sizeMB, [20, 1]);
        const ys = tf.tensor2d(trainData.timeSec, [20, 1]);

        const smallFileMB = 1;
        const bigFileMB = 100;
        const hugeFileMB = 10000;
        doTraining(model).then(() => {
          //alert(model.predict(tf.tensor2d([smallFileMB, bigFileMB, hugeFileMB], [3,1])));
          alert(
            model.predict(
              tf.tensor2d([[smallFileMB], [bigFileMB], [hugeFileMB]])
            )
          );
          model
            .predict(tf.tensor2d([[smallFileMB], [bigFileMB], [hugeFileMB]]))
            .print();
          //modo flat-array de funcion tf.tensor2d()
          //([valor1,valor2],[shape])
        });
      }
    </script>
  </body>
</html>
